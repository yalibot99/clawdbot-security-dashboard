<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÑ Yali's Surf Forecast</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0a192f;
            --bg-secondary: #112240;
            --bg-tertiary: #1d3557;
            --text-primary: #e6f1ff;
            --text-secondary: #8892b0;
            --accent: #64ffda;
            --accent-dark: #00bfa5;
            --ocean: #0077be;
            --waves: #00a8cc;
            --danger: #ff6b6b;
            --warning: #ffd93d;
            --success: #6bcb77;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--ocean) 100%);
            color: var(--text-primary);
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: rgba(17, 34, 64, 0.8);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header h1 span { color: var(--accent); }
        
        .location-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-tertiary);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-top: 1rem;
        }
        
        .spot-selector {
            margin-top: 1rem;
        }
        
        .spot-selector label {
            margin-right: 0.5rem;
            color: var(--text-secondary);
        }
        
        .spot-selector input {
            padding: 0.5rem;
            border-radius: 8px;
            border: 1px solid var(--text-secondary);
            background: var(--bg-primary);
            color: var(--text-primary);
            width: 200px;
        }
        
        .spot-selector button {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            background: var(--accent);
            color: var(--bg-primary);
            cursor: pointer;
            font-weight: 600;
        }
        
        .best-time {
            background: linear-gradient(135deg, var(--accent) 0%, var(--ocean) 100%);
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            margin: 2rem 0;
        }
        
        .best-time h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            opacity: 0.9;
        }
        
        .best-time .time {
            font-size: 4rem;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .best-time .conditions {
            font-size: 1.25rem;
            margin-top: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            display: inline-block;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .metric-card {
            background: rgba(17, 34, 64, 0.8);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .metric-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
        }
        
        .metric-card .label {
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
        
        .wave-chart {
            background: rgba(17, 34, 64, 0.8);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 2rem 0;
        }
        
        .forecast-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .forecast-table th,
        .forecast-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .forecast-table th {
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .condition-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .condition-great { background: var(--success); color: var(--bg-primary); }
        .condition-good { background: var(--accent); color: var(--bg-primary); }
        .condition-fair { background: var(--warning); color: var(--bg-primary); }
        .condition-poor { background: var(--danger); color: white; }
        
        .back-link {
            display: inline-block;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            text-decoration: none;
        }
        
        .back-link:hover { color: var(--accent); }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">‚Üê Back to Security Dashboard</a>
        
        <div class="header">
            <h1>üèÑ <span>Yali's</span> Surf Forecast</h1>
            <div class="location-badge">
                üìç <span id="spot-name">Tel Aviv Beach</span>
                <span id="coords">(32.0853, 34.7818)</span>
            </div>
            
            <div class="spot-selector">
                <label>Or enter location:</label>
                <input type="text" id="lat" placeholder="Latitude" value="32.0853">
                <input type="text" id="lon" placeholder="Longitude" value="34.7818">
                <button onclick="updateForecast()">Get Forecast</button>
            </div>
        </div>
        
        <div class="best-time" id="best-time">
            <h2>üåä Best Time to Surf Tomorrow Morning</h2>
            <div class="time" id="best-hour">--:--</div>
            <div class="conditions" id="best-conditions">Loading...</div>
        </div>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="value" id="wave-height">--</div>
                <div class="label">üåä Wave Height (m)</div>
            </div>
            <div class="metric-card">
                <div class="value" id="wind-speed">--</div>
                <div class="label">üí® Wind (km/h)</div>
            </div>
            <div class="metric-card">
                <div class="value" id="wave-period">--</div>
                <div class="label">‚è±Ô∏è Wave Period (s)</div>
            </div>
            <div class="metric-card">
                <div class="value" id="surf-score">--</div>
                <div class="label">üî• Surf Score</div>
            </div>
        </div>
        
        <div class="wave-chart">
            <h3>üìä Hourly Forecast (6-10 AM)</h3>
            <canvas id="waveChart"></canvas>
        </div>
        
        <div class="wave-chart">
            <h3>üìã Detailed Forecast</h3>
            <table class="forecast-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Wave Height</th>
                        <th>Wind</th>
                        <th>Period</th>
                        <th>Score</th>
                        <th>Conditions</th>
                    </tr>
                </thead>
                <tbody id="forecast-body">
                    <tr><td colspan="6" style="text-align: center;">Loading forecast...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        let waveChart = null;
        
        async function updateForecast() {
            const lat = document.getElementById('lat').value;
            const lon = document.getElementById('lon').value;
            
            document.getElementById('spot-name').textContent = `${lat}, ${lon}`;
            document.getElementById('coords').textContent = `(${lat}, ${lon})`;
            
            try {
                const response = await fetch(`/api/surf/forecast?lat=${lat}&lon=${lon}`);
                const data = await response.json();
                
                if (data.error) {
                    alert(data.error);
                    return;
                }
                
                // Update best time
                if (data.best_time_tomorrow) {
                    document.getElementById('best-hour').textContent = data.best_time_tomorrow.best_time;
                    document.getElementById('best-conditions').textContent = data.best_time_tomorrow.conditions;
                    
                    document.getElementById('wave-height').textContent = 
                        data.best_time_tomorrow.wave_height ? data.best_time_tomorrow.wave_height.toFixed(1) : '--';
                    document.getElementById('wind-speed').textContent = 
                        data.best_time_tomorrow.wind_speed ? data.best_time_tomorrow.wind_speed.toFixed(0) : '--';
                    document.getElementById('surf-score').textContent = 
                        data.best_time_tomorrow.score || '--';
                }
                
                // Update table
                const tbody = document.getElementById('forecast-body');
                tbody.innerHTML = '';
                
                if (data.morning_surf && data.morning_surf.length > 0) {
                    const wavePeriods = await fetch(`/api/surf/conditions?lat=${lat}&lon=${lon}`);
                    const periodData = await wavePeriods.json();
                    const periods = periodData.hourly?.wave_period || [];
                    
                    data.morning_surf.forEach(entry => {
                        const period = periods[entry.hour - 6] || '--';
                        const score = entry.score || 0;
                        let conditionClass = 'condition-poor';
                        let conditionText = '‚ùå Poor';
                        
                        if (score > 40) {
                            conditionClass = 'condition-great';
                            conditionText = 'üî• Great';
                        } else if (score > 20) {
                            conditionClass = 'condition-good';
                            conditionText = '‚úÖ Good';
                        } else if (score > 0) {
                            conditionClass = 'condition-fair';
                            conditionText = '‚ö†Ô∏è Fair';
                        }
                        
                        tbody.innerHTML += `
                            <tr>
                                <td>${entry.hour}:00</td>
                                <td>${entry.wave_height?.toFixed(1) || '--'}m</td>
                                <td>${entry.wind_speed?.toFixed(0) || '--'} km/h</td>
                                <td>${period}s</td>
                                <td>${score}</td>
                                <td><span class="condition-badge ${conditionClass}">${conditionText}</span></td>
                            </tr>
                        `;
                    });
                    
                    // Update chart
                    updateChart(data.morning_surf);
                    
                    // Get wave period for best time
                    if (data.morning_surf[0]) {
                        const bestHour = data.morning_surf[0].hour;
                        const period = periods[bestHour - 6] || '--';
                        document.getElementById('wave-period').textContent = period;
                    }
                } else {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No surf data available for this time</td></tr>';
                }
                
            } catch (error) {
                console.error('Error fetching forecast:', error);
                alert('Failed to load forecast');
            }
        }
        
        function updateChart(data) {
            const ctx = document.getElementById('waveChart').getContext('2d');
            
            if (waveChart) {
                waveChart.destroy();
            }
            
            const labels = data.map(d => `${d.hour}:00`);
            const waveHeights = data.map(d => d.wave_height || 0);
            const windSpeeds = data.map(d => d.wind_speed || 0);
            const scores = data.map(d => d.score || 0);
            
            waveChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Wave Height (m)',
                            data: waveHeights,
                            backgroundColor: 'rgba(100, 255, 218, 0.6)',
                            borderColor: 'rgba(100, 255, 218, 1)',
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Wind (km/h)',
                            data: windSpeeds,
                            backgroundColor: 'rgba(255, 107, 107, 0.6)',
                            borderColor: 'rgba(255, 107, 107, 1)',
                            borderWidth: 1,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Surf Score',
                            data: scores,
                            type: 'line',
                            borderColor: 'rgba(255, 217, 61, 1)',
                            backgroundColor: 'rgba(255, 217, 61, 0.2)',
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y2'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: { display: true, text: 'Wave Height (m)', color: '#64ffda' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#8892b0' }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            title: { display: true, text: 'Wind (km/h)', color: '#ff6b6b' },
                            grid: { drawOnChartArea: false },
                            ticks: { color: '#8892b0' }
                        },
                        y2: {
                            type: 'linear',
                            position: 'right',
                            title: { display: true, text: 'Score', color: '#ffd93d' },
                            grid: { drawOnChartArea: false },
                            ticks: { color: '#8892b0' },
                            display: false
                        },
                        x: {
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#8892b0' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e6f1ff' }
                        }
                    }
                }
            });
        }
        
        // Load forecast on page load
        document.addEventListener('DOMContentLoaded', updateForecast);
    </script>
</body>
</html>
<!-- trigger redeploy -->
